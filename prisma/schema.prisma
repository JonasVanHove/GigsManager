generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Gig {
  id String @id @default(cuid())

  // ── Event details ──────────────────────────────────────
  eventName       String
  date            DateTime
  performers      String // band name or comma-separated member names
  numberOfMusicians Int

  // ── Financials ─────────────────────────────────────────
  performanceFee    Float           // music fee — split among musicians
  technicalFee      Float  @default(0) // optional — belongs to manager, not split
  managerBonusType  String @default("fixed") // "fixed" | "percentage"
  managerBonusAmount Float @default(0) // bonus value ($ or %)

  // ── Payment tracking ───────────────────────────────────
  paymentReceived     Boolean   @default(false)
  paymentReceivedDate DateTime?
  bandPaid            Boolean   @default(false)
  bandPaidDate        DateTime?

  // ── Meta ───────────────────────────────────────────────
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ── User ownership — every gig belongs to one user ─────
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([date])
  @@index([paymentReceived])
  @@index([bandPaid])
}

model User {
  id String @id @default(cuid())

  // Supabase Auth UID (from auth.users table)
  supabaseId String @unique

  email String @unique
  name  String?

  // All gigs belonging to this user
  gigs     Gig[]
  settings UserSettings?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UserSettings {
  id String @id @default(cuid())

  // Which currency to display amounts in (ISO 4217 code)
  currency String @default("EUR")

  // Whether the user (manager) claims these fee components
  claimPerformanceFee Boolean @default(true)
  claimTechnicalFee   Boolean @default(true)

  // Owner
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}